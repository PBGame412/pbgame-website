<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVZ 3D Prototype</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; position: relative; }
        #plant-selection {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        .plant-button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .highlight {
            border: 2px dashed #FF6347;
            position: absolute;
            width: 1.5;
            height: 1.5;
            background-color: rgba(255, 99, 71, 0.3);
            border-radius: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="plant-selection">
        <button class="plant-button" onclick="selectPlant('peashooter')">Peashooter (100 Sun)</button>
        <button class="plant-button" onclick="selectPlant('sunflower')">Sunflower (50 Sun)</button>
        <p>Sun: <span id="sun-count">0</span></p>
    </div>
    <div id="highlight"></div>
    
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Ground with texture
        const textureLoader = new THREE.TextureLoader();
        const groundTexture = textureLoader.load('https://threejsfundamentals.org/threejs/resources/images/stone.jpg');
        const groundMaterial = new THREE.MeshBasicMaterial({ map: groundTexture });
        const groundGeometry = new THREE.PlaneGeometry(10, 10);
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Grid Helper
        const gridHelper = new THREE.GridHelper(10, 10);
        scene.add(gridHelper);

        // Entities lists
        const zombies = [];
        const peas = [];
        let sunPoints = 100;
        let selectedPlant = null;

        // Update Sun Count UI
        function updateSunCount() {
            document.getElementById("sun-count").innerText = sunPoints;
        }

        // Plant Selection
        function selectPlant(plant) {
            selectedPlant = plant;
        }

        // Peashooter
        function createPeashooter(x, z) {
            if (sunPoints >= 100) {
                sunPoints -= 100;
                updateSunCount();
                const peaGeometry = new THREE.SphereGeometry(0.3, 16, 16);
                const peaMaterial = new THREE.MeshBasicMaterial({ color: 0x00FF00 });
                const peashooter = new THREE.Mesh(peaGeometry, peaMaterial);
                peashooter.position.set(x, 0.5, z);
                scene.add(peashooter);
                setInterval(() => shootPea(peashooter.position.x, peashooter.position.z), 2000);
            }
        }

        // Sunflower
        function createSunflower(x, z) {
            if (sunPoints >= 50) {
                sunPoints -= 50;
                updateSunCount();
                const sunGeometry = new THREE.CylinderGeometry(0.3, 0.3, 1, 16);
                const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
                const sunflower = new THREE.Mesh(sunGeometry, sunMaterial);
                sunflower.position.set(x, 0.5, z);
                scene.add(sunflower);
                setInterval(() => { sunPoints += 25; updateSunCount(); }, 5000);
            }
        }

        // Zombie
        function createZombie(x, z) {
            const zombieGeometry = new THREE.BoxGeometry(0.7, 1.2, 0.7);
            const zombieMaterial = new THREE.MeshBasicMaterial({ color: 0x556B2F });
            const zombie = new THREE.Mesh(zombieGeometry, zombieMaterial);
            zombie.position.set(x, 0.6, z);
            zombie.health = 3;
            scene.add(zombie);
            zombies.push(zombie);
        }

        // Shoot Pea
        function shootPea(x, z) {
            const peaGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const peaMaterial = new THREE.MeshBasicMaterial({ color: 0x00FF00 });
            const pea = new THREE.Mesh(peaGeometry, peaMaterial);
            pea.position.set(x, 0.5, z);
            scene.add(pea);
            peas.push(pea);
        }

        // Mouse Click to Plant
        window.addEventListener('click', (event) => {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(ground);
            
            if (intersects.length > 0 && selectedPlant) {
                const point = intersects[0].point;
                if (selectedPlant === 'peashooter') createPeashooter(point.x, point.z);
                if (selectedPlant === 'sunflower') createSunflower(point.x, point.z);
            }
        });

        // Mouse Move to highlight planting area
        window.addEventListener('mousemove', (event) => {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObject(ground);

            if (intersects.length > 0) {
                const point = intersects[0].point;
                const highlight = document.getElementById("highlight");
                highlight.style.left = `${event.clientX - 15}px`;
                highlight.style.top = `${event.clientY - 15}px`;
                highlight.style.display = 'block';
            }
        });

        // Initial Zombies
        createZombie(3, 0);
        createZombie(5, -1);
        updateSunCount();

        camera.position.set(0, 5, 7);
        camera.lookAt(0, 0, 0);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Move peas
            peas.forEach((pea, index) => {
                pea.position.x += 0.05;
                zombies.forEach((zombie, zIndex) => {
                    if (Math.abs(pea.position.x - zombie.position.x) < 0.3 && Math.abs(pea.position.z - zombie.position.z) < 0.3) {
                        zombie.health -= 1;
                        scene.remove(pea);
                        peas.splice(index, 1);
                        if (zombie.health <= 0) {
                            scene.remove(zombie);
                            zombies.splice(zIndex, 1);
                        }
                    }
                });
            });
            
            // Move zombies
            zombies.forEach(zombie => zombie.position.x -= 0.01);
            
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
